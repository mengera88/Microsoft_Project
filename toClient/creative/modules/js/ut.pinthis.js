var PinThis,root,pinThisName="pinthis";root="undefined"!=typeof window&&null!==window?window:global,root.PinThis=PinThis={_utcenv:function(){var t=!1;return undertone&&undertone.creative&&(t=!0),t},_triggerEvent:function(t,e,n){var i=n||document.body;$(i).trigger(pinThisName+"-"+t,[e])},init:function(t,e){var n=this;return n.options=$.extend({},n.defaults,t),n.elem=e,n._build(n.elem,n.options),n},defaults:{tryDeepLink:!0},_build:function(t,e,n){var i=this,o=e||i.options;t=t[0]||t,null!==window.navigator.userAgent.match(/iP/)&&(i.options.deepBrowser=null===window.navigator.userAgent.match(/Pinterest/)&&null===window.navigator.userAgent.match(/CriOS/)?"ios_safari":void 0),o.existingButtonSelector?i._bindButton(t,o):i._addButton(t,o),i._loaded=!0,n&&n(i)},_bindButton:function(t,e){var n=this,i=$(t).find(e.existingButtonSelector);n.handleCount(i[0],null,e),i.on("click",function(){n._clickAction(t,e)})},_addButton:function(t,e){var n,i=this,e=e?e:i.options;if(e.customButton)n=$(e.customButton);else{n=document.createElement("div"),n.className="ut-pin-this-button";var o=document.createElement("img");o.src="http://images.undertone.com/ut/re/modules/pinthis/img/pin_it_button.png",n.appendChild(o)}i.handleCount(n),$(n).on("click",function(){i._clickAction(t,e)}),$(t).append(n)},handleCount:function(t,e,n,i){var o=this,n=n||o.options,e=e||o.elem,r=$(e).attr("data-pin-count"),a=r===!1||"false"===r?!1:r?r:n.showPinCount;a?o.getPinCount($(e).attr("data-pin-url"),function(e){var n=document.createElement("div"),r="position: absolute; color: #777; text-align: center; text-indent: 0; font: Arial, Helvetica, sans-serif;";n.innerHTML=o.prettyPinCount(e),r+="beside"==a?"font-size: 10px; line-height: 20px; left: 41px; top: 0; background-image: url(http://images.undertone.com/ut/re/modules/pinthis/img/count-right.png); background-repeat: no-repeat; background-size: 45px 20px; height: 20px; width: 45px; padding: 0 3px 0 5px; box-sizing: border-box;":"font-size: 12px; line-height: 24px; left: 0; top: -30px; background-image: url(http://images.undertone.com/ut/re/modules/pinthis/img/count.png); background-repeat: no-repeat; background-size: 40px 29px; height: 29px; width: 40px;",n.setAttribute("style",r),t.appendChild(n),i&&i(e)}):i&&i(!1)},_clickAction:function(t,e,n){var i=this,e=e?e:i.options;i._assembleUrl(t,e,function(o){if(i._utcenv()){var r=$(t).attr("data-pin-name")||"";if(e.nameSelector){var a=$(t).find(e.nameSelector)[0];if(a){var c=void 0===a.textContent?"innerText":"textContent";r=a[c]}else r="unnamed"}undertone.creative.trackEvent("Pinterest_pinned",encodeURI(r.replace(/[\s*|-]/gi,"_")),!0)}var s;e.tryDeepLink&&"function"==typeof i.deepLink[e.deepBrowser]?i.deepLink[e.deepBrowser](o):s=window.open(o,"pin"+(new Date).getTime(),"status=no,resizable=yes,scrollbars=yes,personalbar=no,directories=no,location=no,toolbar=no,menubar=no,width=632,height=270,left=0,top=0"),i._triggerEvent("pinned"),e.closeWindow&&s&&s.close(),n&&n(s)})},_assembleUrl:function(t,e,n){var i=this,e=e?e:i.options,o="http://www.pinterest.com/pin/create/button/",r=(t.tagName||t.nodeName,$(t).attr("data-pin-description")||""),a=$(t).attr("data-pin-media"),c=$(t).attr("data-pin-url");if(e.mediaSelector){var s=$(t).find(e.mediaSelector).attr("src");if(/^[a-z]+:\/\//i.test(s))a=encodeURI(s);else{var u=window.location.href,d=u.lastIndexOf("/"),p=u.substring(0,d);a=encodeURI(p+"/"+s)}}if(o+="?url="+encodeURIComponent(c),o+="&media="+encodeURIComponent(a),e.descriptionSelector){var l=$(t).find(e.descriptionSelector)[0];if(l){var m=void 0===l.textContent?"innerText":"textContent";r=l[m]}}""!=r&&(o+="&description="+encodeURIComponent(r)),n&&n(o)},getPinCount:function(t,e){$.ajax({type:"GET",url:"http://api.pinterest.com/v1/urls/count.json",data:{url:t},dataType:"jsonp",success:function(t){e(t.count)},error:function(t,e){console.log("AJAX error",t,e)}})},prettyPinCount:function(t){return t>999&&(t=1e6>t?parseInt(t/1e3,10)+"K+":1e9>t?parseInt(t/1e6,10)+"M+":"++"),t},deepLink:{ios_safari:function(t){var e,n,i,o,r,a;e=t.split("?")[1],e=e.replace(/url=/,"source_url="),e=e.replace(/media=/,"image_url="),e="pinit://pinit/?"+e,n=(new Date).getTime(),i=0,o=10,r=80,a=function(){window.setTimeout(function(){if(o>i)a();else{var e=n+i*r,c=(new Date).getTime(),s=(c-e)/o;r>s&&(window.location=t)}i+=1},r)},window.location=e,a()}}},"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),$.fn[pinThisName]=function(t){return this.each(function(){var e=Object.create(PinThis);e.init(t,this);{var n=$(this);n.data(pinThisName)}})};