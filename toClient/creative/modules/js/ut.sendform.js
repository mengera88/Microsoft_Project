!function(){var t=!1,e="undefined"!=typeof window&&null!==window?window:global,i=e.UTSendForm={$:window.$,MODULE_NAME:"utsendform",EVENT_SUBMITTED:"utsendform_submitted",EVENT_NO_INPUT_DATA:"utsendform_noInputData",EVENT_NO_REDIRECT_URL:"utsendform_noRedirectUrl",DataVO:function(){this.utTrackingId=null,this.utClickId=null,this.utWaitToSubmit=null},options:null,dataVO:null,clickTag:null,elementID:null,$form:null,didBuild:null,init:function(t,e){return this.$form=$(t),this.options=e||new this.DataVO,this.dataVO=this._buildDataVO(),this.dataVO=this._adjustDataVO(this.dataVO),this._setSubmitHandler(),this},_setSubmitHandler:function(){var t=this;this.$form.submit(function(e){return t._preventDefaultOnEvent(e),t._buildJustInTime(),1!=t.dataVO.utWaitToSubmit&&t.submitNow(e),!1})},_preventDefaultOnEvent:function(t){null!=t&&t.preventDefault()},submitNow:function(t){var e,i,n,r;return t&&this._preventDefaultOnEvent(t),this._buildJustInTime(),(e=null==this.clickTag||""==this.clickTag)?!1:(i=this.$form,n=this._serializeFormData(i),(null==n||""==n)&&this._triggerEvent(this.EVENT_NO_INPUT_DATA),r=this._assembleUrl(this.clickTag,n),this._submitUsingGetMethod(r),!1)},_buildJustInTime:function(){this.didBuild||(this.didBuild=!0,this.clickTag=this._requestClickTag(this.dataVO),null==this.clickTag||0==this.clickTag.length?this._triggerEvent(this.EVENT_NO_REDIRECT_URL):this.elementID=this._assembleElementID(this.clickTag))},_buildDataVO:function(){var t;t=new this.DataVO;for(key in t)t[key]=this._stringValid(this.options[key])?this.options[key]:$(this.$form).attr("data-"+key);return this.$form.removeAttr("data-utClickId"),t},_adjustDataVO:function(t){return"true"==t.utWaitToSubmit||"TRUE"==t.utWaitToSubmit||1==t.utWaitToSubmit?t.utWaitToSubmit=!0:("false"==t.utWaitToSubmit||"FALSE"==t.utWaitToSubmit||0==t.utWaitToSubmit)&&(t.utWaitToSubmit=!1),"string"==typeof t.utWaitToSubmit&&"true"!=t.utWaitToSubmit&&"false"!=t.utWaitToSubmit&&(t.utWaitToSubmit=!0),t},_requestClickTag:function(t){var e;if(e=null,t.utClickId&&undertone&&undertone.creative&&undertone.creative.clickTag){{parseInt(t.utClickId)}e=undertone.creative.clickTag(t.utClickId-1)}return e},_assembleElementID:function(t){var e,i,n;return i=this.$form.attr("id"),e=i||this.dataVO.utTrackingId||t,n=e?encodeURI(e.replace(/[\s*|-]/gi,"_")):null},_submitUsingGetMethod:function(t){this._submitAsRedirect(t),this._triggerEventAfterDelay(this.EVENT_SUBMITTED,250)},_triggerEventAfterDelay:function(t){var e=this;delayedTrigger=function(){e._triggerEvent(t)},setTimeout(delayedTrigger,250)},_submitAsRedirect:function(t){window.undertone&&window.undertone.creative&&window.undertone.creative.redirectTo&&window.undertone.creative.redirectTo(t,this.elementID,!0)},_serializeFormData:function(t){var e,i,n,r;e=t.serialize(),e=e.replace(/!/g,"%21"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29"),e=e.replace(/\*/g,"%2A"),e.indexOf("+")>-1&&(e=e.replace(/\+/g,"%20")),i=e.split("&"),n=[],r="";for(var u=0;u<i.length;u++){var a=i[u];"="!=a.slice(-1)&&n.push(a)}return r=n.join("&")},_assembleUrl:function(t,e){var i;return i="&"==t.slice(-1),this._queryStringExists(t)?result=i?t+e:t+"&"+e:(i&&(t=t.substr(0,t.length-1)),result=e.length>0?t+"?"+e:t),result},_triggerEvent:function(t){t=t||this.MODULE_NAME+"_unknown-type",this.$form.trigger(t)},_trackEvent:function(t,e){undertone&&undertone.creative&&undertone.creative.trackEvent&&(t=t||this.MODULE_NAME+"_unknown-event-name",e=e||this.MODULE_NAME+"_unknown-element-id",undertone.creative.trackEvent(t,e,!0))},_queryStringExists:function(t){return t.indexOf("?")>-1||t.indexOf("&")>-1},_stringValid:function(t){var e,i;return i=typeof t,("boolean"==i||"number"==i)&&(t=t.toString(),i=typeof t),null==t||""==t||"object"==i?!1:"string"!=i?!1:(e=this._removeAllSpaces(t),0==e.length?!1:!0)},_removeAllSpaces:function(t){return $.trim(t.replace(/ /g,""))},initDebugReporter:function(){var e,i;e=!1;try{e=!0}catch(n){}if(t&&e);else{var r=function(){};i=new Object,i.addSubmitDetail=r,i.addTrackEventDetail=r,i.addTriggerEventDetail=r,i.setDataVO=r,i.printAndClear=r}return i}};"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),$.fn.utsendform=function(t){return this.each(function(){var e=e=Object.create(i).init(this,t),n=$(this);n.data.submitNow||n.data("submitNow",function(){e.submitNow()})})}}();